I/O 时间可以通过以下方式测量：

■ I/O 请求时间（也称为 I/O 响应时间）：从发出 I/O 到完成的全部时间 
■ I/O 等待时间：等待队列 
■ I/O 服务时间：处理 I/O 的时间（未等待）

从内核：

■ Block I/O 等待时间（也称为 OS 等待时间）是从创建新 I/O 并将其插入内核 I/O 队列到离开最终内核队列并发送到磁盘设备所花费的时间。这可能跨越多个内核级队列，包括块 I/O 层队列和磁盘设备队列。
■ Block I/O 服务时间是从向设备发出请求到设备完成中断的时间。
■ Block I/O 请求时间既是 Block I/O 等待时间，也是 Block I/O 服务时间：从创建 I/O 到完成 I/O 的全长时间。

从磁盘：

■ Disk wait time （磁盘等待时间） 是在磁盘队列上花费的时间。
■ 磁盘服务时间是主动处理 I/O 所需的磁盘队列之后的时间。
■ 磁盘请求时间（也称为磁盘响应时间和磁盘 I/O 延迟）既是磁盘等待时间，也是磁盘服务时间，等于块 I/O 服务时间。

磁盘设备 对于每个磁盘设备，请检查： 

■ 利用率：设备繁忙的时间 
■ 饱和度：I/O 在队列中等待的程度 
■ 错误：设备错误

对于每个磁盘控制器，请检查： 

■ 利用率：当前与最大吞吐量之比，运行速率也是如此 
■ 饱和度：由于控制器饱和而等待 I/O 的程度 
■ 错误：控制器错误

以下是描述磁盘 I/O 工作负载的基本属性：

■ I/O 速率 
■ I/O 吞吐量 
■ I/O 大小 
■ 读/写比率 
■ 随机与顺序

磁盘 I/O 的关键指标是： 

■ 磁盘利用率 
■ 响应时间

检查清单

■ 系统范围的 IOPS 速率是多少？每个磁盘？每个控制器？
■ 系统范围的吞吐量是多少？每个磁盘？每个控制器？
■ 哪些应用程序或用户正在使用磁盘？
■ 正在访问哪些文件系统或文件？
■ 是否遇到任何错误？它们是由于无效的请求还是磁盘上的问题造成的？
■ 可用磁盘的 I/O 平衡程度如何？
■ 涉及的每条传输总线的 IOPS 是多少？
■ 涉及的每条传输总线的吞吐量是多少？
■ 将发出哪些非数据传输磁盘命令？
■ 为什么会发出磁盘 I/O （内核调用路径）？
■ 磁盘 I/O 应用程序同步的程度如何？
■ I/O 到达时间的分布情况如何？

结果性能：

■ 每个磁盘的繁忙程度 （利用率） ？
■ 每个磁盘的 I/O 饱和度如何（等待排队）？
■ 平均 I/O 服务时间是多少？
■ 平均 I/O 等待时间是多少？
■ 是否存在延迟较高的 I/O 异常值？
■ I/O 延迟的完整分布是什么？
■ 系统资源控制（如 I/O 限制）是否存在并处于活动状态？
■ 非数据传输磁盘命令的延迟是多少？


请检查静态配置的以下方面：

■ 存在多少个磁盘？哪些类型（例如 SMR、MLC）？大小？
■ 磁盘固件是什么版本？
■ 存在多少个磁盘控制器？哪些接口类型？
■ 磁盘控制器卡是否连接到高速插槽？
■ 每个 HBA 连接了多少个磁盘？
■ 如果存在磁盘 / 控制器电池备份，它们的功率水平是多少？
■ 磁盘控制器固件是什么版本？
■ RAID 是否已配置？包括条带宽度在内的具体情况如何？
■ 多路径是否可用并已配置？
■ 磁盘设备驱动程序是什么版本？
■ 服务器主内存大小是多少？是否有页面和缓冲区缓存使用？
■ 是否有任何存储设备驱动程序的操作系统错误/补丁？
■ 是否有用于磁盘 I/O 的资源控制？


# perf:

# perf record -e block:block_rq_complete --filter 'nr_sector > 200'

跟踪所有块完成，仅同步写入，直到 Ctrl-C：
# perf record -e block:block_rq_complete --filter 'rwbs == "WS"

跟踪所有块完成，所有类型的写入，直到 Ctrl-C：
# perf record -e block:block_rq_complete --filter 'rwbs ~ "*W*"'

# 磁盘 I/O 延迟
磁盘 I/O 延迟（前面称为磁盘请求时间）也可以通过记录磁盘提交和完成事件来确定，以供以后分析。下面记录它们 60 秒，然后将事件写入 out.disk01.txt 文件：

# perf record -e block:block_rq_issue,block:block_rq_complete -a sleep 60
# perf script --header > out.disk01.txt